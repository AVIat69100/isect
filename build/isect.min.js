!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r(t.isect={})}(this,function(t){"use strict";var a=function(t,r){this.key=t,this.data=r,this.left=null,this.right=null};function r(t,r){return r<t?1:t<r?-1:0}function h(t,r,e){if(null===r)return r;var n,o,i,f=new a;for(n=o=f;;){var u=e(t,r.key);if(u<0){if(null===r.left)break;if(e(t,r.left.key)<0&&(i=r.left,r.left=i.right,i.right=r,null===(r=i).left))break;o.left=r,r=(o=r).left}else{if(!(0<u))break;if(null===r.right)break;if(0<e(t,r.right.key)&&(i=r.right,r.right=i.left,i.left=r,null===(r=i).right))break;n.right=r,r=(n=r).right}}return n.right=r.left,o.left=r.right,r.left=f.right,r.right=f.left,r}function s(t,r,e,n,o){var i=new a(t,r);if(o._size++,null===e)return i.left=i.right=null,i;var f=n(t,(e=h(t,e,n)).key);return f<0?(i.left=e.left,(i.right=e).left=null):0<=f&&(i.right=e.right,(i.left=e).right=null),i}function e(t,r,e,n){var o;return null===r?null:0===e(t,(r=h(t,r,e)).key)?(null===r.left?o=r.right:(o=h(t,r.left,e)).right=r.right,n._size--,o):r}function y(t,r,e){var n,o;if(null===r)n=o=null;else{var i=e((r=h(t,r,e)).key,t);0===i?(n=r.left,o=r.right):i<0?(o=r.right,r.right=null,n=r):(n=r.left,r.left=null,o=r)}return{left:n,right:o}}var m=function(t){void 0===t&&(t=r),this._comparator=t,this._root=null,this._size=0},n={size:{configurable:!0}};m.prototype.insert=function(t,r){return this._root=s(t,r,this._root,this._comparator,this)},m.prototype.add=function(t,r){return this._root=function(t,r,e,n,o){var i=new a(t,r);if(null===e)return i.left=i.right=null,o._size++,i;var f=n(t,(e=h(t,e,n)).key);return 0===f?e:(f<0?(i.left=e.left,(i.right=e).left=null):0<f&&(i.right=e.right,(i.left=e).right=null),o._size++,i)}(t,r,this._root,this._comparator,this)},m.prototype.remove=function(t){this._root=e(t,this._root,this._comparator,this)},m.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=h(t.key,this._root,this._comparator),this._root=e(t.key,this._root,this._comparator,this),{key:t.key,data:t.data}}return null},m.prototype.findStatic=function(t){for(var r=this._root,e=this._comparator;r;){var n=e(t,r.key);if(0===n)return r;r=n<0?r.left:r.right}return null},m.prototype.find=function(t){return this._root&&(this._root=h(t,this._root,this._comparator),0!==this._comparator(t,this._root.key))?null:this._root},m.prototype.contains=function(t){for(var r=this._root,e=this._comparator;r;){var n=e(t,r.key);if(0===n)return!0;r=n<0?r.left:r.right}return!1},m.prototype.forEach=function(t,r){for(var e=this._root,n=[],o=!1;!o;)null!==e?(n.push(e),e=e.left):0!==n.length?(e=n.pop(),t.call(r,e),e=e.right):o=!0;return this},m.prototype.range=function(t,r,e,n){for(var o=[],i=this._comparator,f=this._root;0!==o.length||f;)if(f)o.push(f),f=f.left;else{if(0<i((f=o.pop()).key,r))break;if(0<=i(f.key,t)&&e.call(n,f))return this;f=f.right}return this},m.prototype.keys=function(){var e=[];return this.forEach(function(t){var r=t.key;return e.push(r)}),e},m.prototype.values=function(){var e=[];return this.forEach(function(t){var r=t.data;return e.push(r)}),e},m.prototype.min=function(){return this._root?this.minNode(this._root).key:null},m.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},m.prototype.minNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.left;)t=t.left;return t},m.prototype.maxNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.right;)t=t.right;return t},m.prototype.at=function(t){for(var r=this._root,e=!1,n=0,o=[];!e;)if(r)o.push(r),r=r.left;else if(0<o.length){if(r=o.pop(),n===t)return r;n++,r=r.right}else e=!0;return null},m.prototype.next=function(t){var r=this._root,e=null;if(t.right){for(e=t.right;e.left;)e=e.left;return e}for(var n=this._comparator;r;){var o=n(t.key,r.key);if(0===o)break;r=o<0?(e=r).left:r.right}return e},m.prototype.prev=function(t){var r=this._root,e=null;if(null!==t.left){for(e=t.left;e.right;)e=e.right;return e}for(var n=this._comparator;r;){var o=n(t.key,r.key);if(0===o)break;r=o<0?r.left:(e=r).right}return e},m.prototype.clear=function(){return this._root=null,this._size=0,this},m.prototype.toList=function(){return function(t){var r=t,e=[],n=!1,o={next:null},i=o;for(;!n;)r?(e.push(r),r=r.left):0<e.length?r=(r=i=i.next=e.pop()).right:n=!0;return i.next=null,o.next}(this._root)},m.prototype.load=function(t,r,e){void 0===t&&(t=[]),void 0===r&&(r=[]),void 0===e&&(e=!1);var n=t.length,o=this._comparator;if(e&&function t(r,e,n,o,i){if(o<=n)return;var f=r[n+o>>1];var u=n-1;var a=o+1;for(;;){for(;i(r[++u],f)<0;);for(;0<i(r[--a],f););if(a<=u)break;var l=r[u];r[u]=r[a],r[a]=l,l=e[u],e[u]=e[a],e[a]=l}t(r,e,n,a,i);t(r,e,a+1,o,i)}(t,r,0,n-1,o),null===this._root)this._root=function t(r,e,n,o,i){var f=i-o;if(0<f){var u=o+Math.floor(f/2),a=e[u],l=n[u],h={key:a,data:l,parent:r};return h.left=t(h,e,n,o,u),h.right=t(h,e,n,u+1,i),h}return null}(this._root,t,r,0,n),this._size=n;else{var i=function(t,r,e){void 0===e&&(e=function(t,r){return t-r});var n={},o=n,i=t,f=r;for(;null!==i&&null!==f;)e(i.key,f.key)<0?i=(o.next=i).next:f=(o.next=f).next,o=o.next;null!==i?o.next=i:null!==f&&(o.next=f);return n.next}(this.toList(),function(t,r){for(var e={next:null},n=e,o=0;o<t.length;o++)n=n.next={key:t[o],data:r[o]};return n.next=null,e.next}(t,r),o);n=this._size+n,this._root=function t(r,e,n){var o=n-e;if(0<o){var i=e+Math.floor(o/2),f=t(r,e,i),u=r.head;return u.left=f,r.head=r.head.next,u.right=t(r,i+1,n),u}return null}({head:i},0,n)}return this},m.prototype.isEmpty=function(){return null===this._root},n.size.get=function(){return this._size},m.prototype.toString=function(t){void 0===t&&(t=function(t){return t.key});var r=[];return function t(r,e,n,o,i){if(r){o(e+(n?"└── ":"├── ")+i(r)+"\n");var f=e+(n?"    ":"│   ");r.left&&t(r.left,f,!1,o,i),r.right&&t(r.right,f,!0,o,i)}}(this._root,"",!0,function(t){return r.push(t)},t),r.join("")},m.prototype.update=function(t,r,e){var n,o,i,f=this._comparator,u=y(t,this._root,f),a=u.left,l=u.right;this._size--,f(t,r)<0?l=s(r,e,l,f,this):a=s(r,e,a,f,this),this._root=(n=a,i=f,null===(o=l)?n:(null===n||((o=h(n.key,o,i)).left=n),o))},m.prototype.split=function(t){return y(t,this._root,this._comparator)},Object.defineProperties(m.prototype,n);var l=1e-9;function x(t,r,e){var n=t.from.y-e,o=e-t.to.y,i=t.to.y-t.from.y;if(Math.abs(n)<l)return Math.abs(i)<l?r<=t.from.x?t.from.x:r>t.to.x?t.to.x:r:t.from.x;var f,u=t.to.x-t.from.x;return o<=n?(f=n*(u/i),t.from.x-f):(f=o*(u/i),t.to.x+f)}function _(t,r){return Math.abs(t.x-r.x)<l&&Math.abs(t.y-r.y)<l}function f(y,a){var l,i,h,f,s=!1,c=new m(v),p={beforeLeft:null,left:null,right:null,afterRight:null},u={left:null,right:null};return{insertSegments:function(t,r,e){var n;l=e.y,h=e.x;for(var o=0;o<t.length;++o)n=t[o],c.add(n);for(o=0;o<r.length;++o)n=r[o],c.add(n)},deleteSegments:function(t,r,e){var n,o=c._size;for(f=h,i=l,l=e.y,h=e.x,s=!0,n=0;n<t.length;++n)d(t[n],e);for(n=0;n<r.length;++n)d(r[n],e);s=!1,c._size!==o-r.length-t.length&&y("Segments were not removed from a tree properly. Precision error?")},getLeftRightPoint:function(t){var r,e=c._root,n=Number.POSITIVE_INFINITY;for(;e;){var o=x(e.key,t.x,t.y),i=t.x-o;if(0<=i){if(!(i<n))break;n=i,e=(r=e).left}else{if(!(-i<n))break;n=-i,e=(r=e).right}}u.left=r&&r.key;var f=r&&c.next(r);return u.right=f&&f.key,u},getBoundarySegments:function(t,r){var e,n,o,i=t.length;e=n=0<i?t[0]:r[0];for(o=1;o<i;++o){var f=t[o],u=v(e,f);0<u&&(e=f),(u=v(n,f))<0&&(n=f)}for(o=0<i?0:1;o<r.length;++o)f=r[o],0<(u=v(e,f))&&(e=f),(u=v(n,f))<0&&(n=f);var a=c.find(e);a||y("Left is missing. Precision error?");var l=c.find(n);l||y("Right is missing. Precision error?");var h=a&&c.prev(a),s=l&&c.next(l);for(;s&&0===l.key.dy&&0===s.key.dy;)s=c.next(s);return p.beforeLeft=h&&h.key,p.left=a&&a.key,p.right=l&&l.key,p.afterRight=s&&s.key,p},findSegmentsWithPoint:function(t,r){var e=c._root;for(;e;){var n=x(e.key,t.x,t.y),o=t.x-n;if(Math.abs(o)<a){g(e,t,r);break}e=o<0?e.left:e.right}},status:c,checkDuplicate:function(){var e;c.forEach(function(t){var r=t.key;e&&_(e.from,r.from)&&_(e.to,r.to)&&y("Duplicate key in the status! This may be caused by Floating Point rounding error"),e=r})},printStatus:function(t){void 0===t&&(t="");console.log(t,"status line: ",h,l),c.forEach(function(t){var r=x(t.key,h,l);console.log(r+" "+t.key.name)})},getLastPoint:function(){return{x:h,y:l}}};function v(t,r){if(t===r)return 0;var e=x(t,h,l)-x(r,h,l);if(Math.abs(e)>=a)return e;var n=Math.abs(t.dy)<a,o=Math.abs(r.dy)<a;if(n&&o)return r.to.x-t.to.x;if(n)return s?-1:1;if(o)return s?r.from.x>=h?-1:1:-1;var i=t.angle,f=r.angle;if(Math.abs(i-f)>=a)return s?i-f:f-i;var u=t.from.y-r.from.y;return Math.abs(u)>=a?-u:(u=t.to.y-r.to.y,Math.abs(u)>=a?-u:0)}function g(t,r,e){e(t.key),function t(r,e,n){if(!r)return;var o=x(r.key,e.x,e.y);var i=e.x-o;Math.abs(i)<a?g(r,e,n):t(r.right,e,n)}(t.left,r,e),function t(r,e,n){if(!r)return;var o=x(r.key,e.x,e.y);var i=e.x-o;Math.abs(i)<a?g(r,e,n):t(r.left,e,n)}(t.right,r,e)}function d(t,r){c.find(t)?c.remove(t):(h=f,l=i,c.find(t)&&c.remove(t),l=r.y,h=r.x)}}var k=function(t,r){this.point=t,r&&(this.from=[r])},b=[];function M(t){Math.abs(t.x)<l&&(t.x=0),Math.abs(t.y)<l&&(t.y=0)}function z(t){throw new Error(t)}function S(t,r){return t?r?t.concat(r):t:r}function w(t,r){var e=r.y-t.y;return Math.abs(e)<l&&(e=t.x-r.x,Math.abs(e)<l&&(e=0)),e}function c(t,r){var e=t.from,n=r.from,o=e.x,i=e.y,f=n.x,u=n.y,a=t.from.x-t.to.x,l=t.from.y-t.to.y,h=r.from.x-r.to.x,s=r.from.y-r.to.y,y=a*s-h*l,c=(l*(o-f)-a*(i-u))/y;if(!(c<0||1<c)){var p=(h*(u-i)+s*(o-f))/y;return 0<=p&&p<=1?{x:o-p*a,y:i-p*l}:void 0}}t.sweep=function(t,r){var e,h,s,y,o=[],v=r&&r.onFound||function(t,r,e,n){o.push({point:t,segments:S(S(r,e),n)})},u=r&&r.onError||z,g=(e=new m(w),{isEmpty:function(){return e.isEmpty()},size:function(){return e.size},pop:function(){var t=e.pop();return t&&t.data},find:function(t){return e.find(t)},insert:function(t){e.add(t.point,t)}}),c=f(u,l);return t.forEach(i),{run:function(){for(;!g.isEmpty();){var t=g.pop();if(n(t))return}return o},step:function(){return!g.isEmpty()&&(n(g.pop()),!0)},addSegment:i,eventQueue:g,sweepStatus:c,results:o};function n(t){y=t.point;var r=t.from||b;h=s=void 0,c.findSegmentsWithPoint(y,p),h||(h=b),s||(s=b);var e,n,o=r.length,i=s.length,f=h.length,u=1<o+i+f;if((u||!u&&0===o&&0===f&&0<i)&&(t.isReported=!0,v(y,s,h,r)))return!0;if(c.deleteSegments(h,s,y),c.insertSegments(s,r,y),o+i===0){var a=c.getLeftRightPoint(y);if(!(e=a.left))return;if(!(n=a.right))return;d(e,n,t)}else{var l=c.getBoundarySegments(r,s);d(l.beforeLeft,l.left,t),d(l.right,l.afterRight,t)}return!1}function p(t){_(t.to,y)?h?h.push(t):h=[t]:_(t.from,y)||(s?s.push(t):s=[t])}function d(t,r,e){if(t&&r){var n=function(t,r){var e=t.from,n=r.from,o=e.x,i=e.y,f=n.x,u=n.y,a=t.dx,l=t.dy,h=r.dx,s=r.dy,y=a*s-h*l,c=(l*(o-f)-a*(i-u))/y;if(!(c<0||1<c)){var p=(h*(u-i)+s*(o-f))/y;return 0<=p&&p<=1?{x:o-p*a,y:i-p*l}:void 0}}(t,r);if(n){var o=e.point.y-n.y;if(!(o<-l||Math.abs(o)<l&&n.x<=e.point.x)){M(n);var i=g.find(n);if(i&&i.isReported)u("We already reported this event.");else if(!i){var f=new k(n);g.insert(f)}}}}}function i(t){var r=t.from,e=t.to;M(r),M(e);var n,o,i,f=r.y-e.y;if(Math.abs(f)<1e-5&&(r.y=e.y,t.dy=0),r.y<e.y||r.y===e.y&&r.x>e.x){var u=r;r=t.from=e,e=t.to=u}t.dy=r.y-e.y,t.dx=r.x-e.x,t.angle=(n=t.dy,o=t.dx,i=n/(Math.abs(n)+Math.abs(o)),o<0?i-1:1-i);var a=t.dy===t.dx&&0===t.dy,l=g.find(r);if(l&&!a){var h=l.data.from;if(h)for(var s=0;s<h.length;++s){var y=h[s];if(_(y.to,e))return v(y.from,[],y.from,y.to),void v(y.to,[],y.from,y.to)}}if(a)p=new k(e),g.insert(p);else{if(l)l.data.from?l.data.from.push(t):l.data.from=[t];else{var c=new k(r,t);g.insert(c)}var p=new k(e);g.insert(p)}}},t.brute=function(i,t){var o,f=[],u=t&&t.onFound||function(t,r){f.push({point:t,segments:r})};return{run:function(){for(var t=0;t<i.length;++t)for(var r=i[t],e=t+1;e<i.length;++e){var n=i[e],o=c(r,n);if(o&&u(o,[r,n]))return}return f},results:f,step:function(){o||(o={i:0});for(var t=i[o.i],r=o.i+1;r<i.length;++r){var e=i[r],n=c(t,e);if(n&&u(n,[t,e]))return}return o.i+=1,o.i<i.length}}},Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=isect.min.js.map
